<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Helios Protocol | Qubic AI Node</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { background-color: #030712; color: #f9fafb; font-family: sans-serif; overflow: hidden; }
        
        .glass-card {
            background: linear-gradient(145deg, rgba(31, 41, 55, 0.6) 0%, rgba(17, 24, 39, 0.8) 100%);
            border: 1px solid rgba(75, 85, 99, 0.4);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        }
        
        /* Custom Animations */
        @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 15px rgba(16, 185, 129, 0.1); } 50% { box-shadow: 0 0 30px rgba(16, 185, 129, 0.4); } }
        .mining-active { animation: pulse-glow 2s infinite; border-color: rgba(16, 185, 129, 0.5); }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #111827; }
        ::-webkit-scrollbar-thumb { background: #374151; border-radius: 4px; }
    </style>
</head>
<body>

    <div id="debug-error" style="display:none; position:fixed; top:0; left:0; width:100%; background:red; color:white; padding:20px; z-index:9999;">
        <strong>CRITICAL ERROR:</strong> <span id="error-text"></span>
    </div>

    <script>
        window.onerror = function(msg, url, line) {
            document.getElementById('debug-error').style.display = 'block';
            document.getElementById('error-text').innerText = msg + " (Line: " + line + ")";
        };
    </script>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- INTERNAL ICONS (No external dependencies) ---
        const IconActivity = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>;
        const IconCpu = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="4" y="4" width="16" height="16" rx="2" ry="2"/><rect x="9" y="9" width="6" height="6"/><line x1="9" y1="1" x2="9" y2="4"/><line x1="15" y1="1" x2="15" y2="4"/><line x1="9" y1="20" x2="9" y2="23"/><line x1="15" y1="20" x2="15" y2="23"/><line x1="20" y1="9" x2="23" y2="9"/><line x1="20" y1="14" x2="23" y2="14"/><line x1="1" y1="9" x2="4" y2="9"/><line x1="1" y1="14" x2="4" y2="14"/></svg>;
        const IconWallet = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20 12V8H6a2 2 0 0 1-2-2c0-1.1.9-2 2-2h12v4"/><path d="M4 6v12c0 1.1.9 2 2 2h14v-4"/><path d="M18 12a2 2 0 0 0-2 2c0 1.1.9 2 2 2h4v-4h-4z"/></svg>;
        const IconSun = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#FBBF24" strokeWidth="2"><circle cx="12" cy="12" r="5"/><path d="M12 1v2"/><path d="M12 21v2"/><path d="M4.22 4.22l1.42 1.42"/><path d="M18.36 18.36l1.42 1.42"/><path d="M1 12h2"/><path d="M21 12h2"/><path d="M4.22 19.78l1.42-1.42"/><path d="M18.36 5.64l1.42-1.42"/></svg>;
        const IconZap = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>;
        const IconPlay = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>;
        const IconStop = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/></svg>;

        // --- COMPONENTS ---

        // 1. SIDEBAR
        const Sidebar = ({ activeTab, setTab }) => {
            const items = [
                { id: 'dash', icon: <IconActivity/>, label: 'Dashboard' },
                { id: 'mining', icon: <IconCpu/>, label: 'AI Training Rig' },
                { id: 'wallet', icon: <IconWallet/>, label: 'Wallet' },
            ];

            return (
                <div className="w-64 h-screen border-r border-gray-800 bg-[#0b0f19] flex flex-col p-4">
                    <div className="flex items-center gap-3 px-2 mb-10 mt-2">
                        <div className="w-8 h-8 bg-gradient-to-tr from-emerald-500 to-cyan-500 rounded-lg flex items-center justify-center font-bold text-black shadow-lg shadow-emerald-500/20">H</div>
                        <div>
                            <h1 className="font-bold text-lg tracking-tight text-white">HELIOS</h1>
                            <p className="text-[10px] text-gray-500 uppercase tracking-wider">Protocol V2.4</p>
                        </div>
                    </div>

                    <nav className="space-y-2 flex-1">
                        {items.map(item => (
                            <button 
                                key={item.id}
                                onClick={() => setTab(item.id)}
                                className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${activeTab === item.id ? 'bg-emerald-500/10 text-emerald-400 border border-emerald-500/20' : 'text-gray-400 hover:bg-gray-800 hover:text-white'}`}
                            >
                                {item.icon}
                                <span className="text-sm font-medium">{item.label}</span>
                            </button>
                        ))}
                    </nav>

                    <div className="p-4 rounded-xl bg-gray-900 border border-gray-800">
                        <div className="flex items-center gap-2 mb-2">
                            <div className="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div>
                            <span className="text-xs font-mono text-emerald-500">NETWORK SYNCED</span>
                        </div>
                        <div className="text-[10px] text-gray-500 font-mono">Tick: {Math.floor(Date.now()/1000)}</div>
                    </div>
                </div>
            );
        };

        // 2. DASHBOARD VIEW
        const DashboardView = ({ isMining }) => (
            <div className="p-8 space-y-6 animate-fade-in">
                <header>
                    <h2 className="text-3xl font-bold mb-1 text-white">Network Overview</h2>
                    <p className="text-gray-400 text-sm">Real-time telemetry from your local node.</p>
                </header>

                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div className="glass-card p-6 rounded-2xl relative overflow-hidden">
                        <div className="absolute right-4 top-4 opacity-20"><IconSun/></div>
                        <p className="text-gray-400 text-xs font-bold uppercase mb-2">Solar Input</p>
                        <p className="text-4xl font-mono text-yellow-400">4,250<span className="text-sm text-gray-500 ml-1">W</span></p>
                        <div className="mt-4 h-1 w-full bg-gray-700 rounded-full overflow-hidden"><div className="h-full bg-yellow-400 w-[75%]"></div></div>
                    </div>
                    
                    <div className="glass-card p-6 rounded-2xl relative overflow-hidden">
                        <p className="text-gray-400 text-xs font-bold uppercase mb-2">Battery Storage</p>
                        <p className="text-4xl font-mono text-blue-400">84<span className="text-sm text-gray-500 ml-1">%</span></p>
                        <div className="mt-4 h-1 w-full bg-gray-700 rounded-full overflow-hidden"><div className="h-full bg-blue-400 w-[84%]"></div></div>
                    </div>

                    <div className={`glass-card p-6 rounded-2xl relative overflow-hidden transition-all ${isMining ? 'border-emerald-500/50 shadow-[0_0_20px_rgba(16,185,129,0.2)]' : ''}`}>
                        <div className="absolute right-4 top-4 opacity-20"><IconCpu/></div>
                        <p className="text-gray-400 text-xs font-bold uppercase mb-2">Node Status</p>
                        <p className={`text-2xl font-black ${isMining ? 'text-emerald-400' : 'text-gray-500'}`}>{isMining ? 'MINING ACTIVE' : 'IDLE'}</p>
                        <p className="text-xs text-gray-400 mt-2">{isMining ? 'Running Neural Net Job...' : 'Waiting for excess energy...'}</p>
                    </div>
                </div>

                {/* Simulated Terminal */}
                <div className="glass-card rounded-2xl p-0 overflow-hidden h-[300px] flex flex-col">
                    <div className="bg-black/40 px-4 py-2 border-b border-gray-700 flex items-center justify-between">
                        <span className="text-xs font-mono text-gray-400">system_kernel_log.sh</span>
                        <div className="flex gap-1.5"><div className="w-2.5 h-2.5 rounded-full bg-red-500/50"></div><div className="w-2.5 h-2.5 rounded-full bg-yellow-500/50"></div><div className="w-2.5 h-2.5 rounded-full bg-green-500/50"></div></div>
                    </div>
                    <div className="p-4 font-mono text-xs text-gray-300 space-y-2 overflow-hidden flex-1 relative bg-[#050505]">
                        <div className="opacity-50">[SYSTEM] Initializing Helios Protocol v2.4...</div>
                        <div className="opacity-70">[NET] Connected to 451 Peers (Latency: 24ms)</div>
                        <div>[ENERGY] Solar Array detected: <span className="text-yellow-400">ONLINE</span></div>
                        {isMining && (
                            <>
                                <div className="text-emerald-400 animate-pulse">[AI-JOB] Received Task #8821 from Qubic Network</div>
                                <div>[AI-JOB] Loading Dataset: MNIST_Large_v2 (2.4GB)</div>
                                <div>[GPU] Allocation: 98% | Temp: 65Â°C</div>
                                <div className="text-blue-400">[CONTRACT] Proof-of-Work Submitted -`{'>'} Hash: 0x7fa...</div>
                            </>
                        )}
                        <div className="absolute bottom-4 left-4 animate-pulse text-emerald-500">_</div>
                    </div>
                </div>
            </div>
        );

        // 3. MINING VIEW
        const MiningView = ({ isMining, setIsMining, trainingData }) => {
            const drawChart = () => {
                const h = 150, w = 600;
                if(trainingData.length < 2) return "";
                const maxLoss = 1.0;
                
                const points = trainingData.map((d, i) => {
                    const x = (i / (trainingData.length - 1)) * w;
                    const y = h - (d / maxLoss) * h;
                    return `${x},${y}`;
                }).join(" ");

                return <polyline points={points} fill="none" stroke="#10b981" strokeWidth="2" />;
            };

            return (
                <div className="p-8 space-y-6">
                    <header className="flex justify-between items-center">
                        <div>
                            <h2 className="text-3xl font-bold mb-1 text-white">AI Training Rig</h2>
                            <p className="text-gray-400 text-sm">Contribute compute power to earn QUBIC.</p>
                        </div>
                        <button 
                            onClick={() => setIsMining(!isMining)}
                            className={`px-6 py-3 rounded-xl font-bold flex items-center gap-2 transition-all ${isMining ? 'bg-red-500/20 text-red-400 border border-red-500 hover:bg-red-500/30' : 'bg-emerald-500 text-black hover:bg-emerald-400 shadow-[0_0_20px_rgba(16,185,129,0.4)]'}`}
                        >
                            {isMining ? <><IconStop/> STOP NODE</> : <><IconPlay/> START AI NODE</>}
                        </button>
                    </header>

                    <div className="grid grid-cols-12 gap-6 h-[400px]">
                        <div className="col-span-8 glass-card rounded-2xl p-6 flex flex-col relative overflow-hidden">
                             <div className="flex justify-between items-center mb-6">
                                <h3 className="font-bold flex items-center gap-2 text-sm uppercase tracking-wider text-gray-400">Model Loss Function</h3>
                                {isMining && <span className="px-2 py-1 bg-emerald-900/50 text-emerald-400 text-[10px] rounded border border-emerald-500/30">TRAINING EPOCH {trainingData.length * 12}</span>}
                            </div>
                            
                            <div className="flex-1 bg-black/20 rounded-xl border border-gray-700/50 relative flex items-end p-4 overflow-hidden">
                                {isMining ? (
                                    <svg viewBox="0 0 600 150" className="w-full h-full preserve-3d">
                                        {drawChart()}
                                        <line x1="0" y1="37" x2="600" y2="37" stroke="#333" strokeDasharray="4"/>
                                        <line x1="0" y1="75" x2="600" y2="75" stroke="#333" strokeDasharray="4"/>
                                        <line x1="0" y1="112" x2="600" y2="112" stroke="#333" strokeDasharray="4"/>
                                    </svg>
                                ) : (
                                    <div className="absolute inset-0 flex items-center justify-center text-gray-600 font-mono text-sm">
                                        NODE OFFLINE - START MINING TO VIEW DATA
                                    </div>
                                )}
                            </div>
                        </div>

                        <div className="col-span-4 space-y-4">
                            <div className="glass-card p-4 rounded-xl">
                                <p className="text-gray-400 text-xs">Current Hashrate</p>
                                <p className="text-2xl font-mono text-white">{isMining ? "452" : "0"} <span className="text-sm text-gray-500">it/s</span></p>
                            </div>
                            <div className="glass-card p-4 rounded-xl">
                                <p className="text-gray-400 text-xs">Model Accuracy</p>
                                <p className="text-2xl font-mono text-emerald-400">{isMining ? (90 + Math.random()*5).toFixed(2) : "0.00"}%</p>
                            </div>
                            <div className="glass-card p-4 rounded-xl">
                                <p className="text-gray-400 text-xs">GPU Temperature</p>
                                <div className="w-full bg-gray-700 h-2 rounded-full mt-2 overflow-hidden">
                                    <div className="bg-orange-500 h-full transition-all duration-1000" style={{width: isMining ? '65%' : '20%'}}></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // 4. WALLET VIEW
        const WalletView = ({ balance, claimRewards, pendingRewards }) => (
             <div className="p-8 space-y-6">
                <header>
                    <h2 className="text-3xl font-bold mb-1 text-white">Asset Management</h2>
                    <p className="text-gray-400 text-sm">Manage your QUBIC earnings and staking.</p>
                </header>

                <div className="grid grid-cols-2 gap-8">
                    <div className="h-64 rounded-2xl bg-gradient-to-br from-emerald-600 to-teal-900 p-8 flex flex-col justify-between shadow-2xl relative overflow-hidden">
                        <div className="absolute -right-10 -top-10 text-white/10"><IconZap/></div>
                        <div className="flex justify-between items-start z-10">
                            <div>
                                <p className="text-emerald-100 text-sm font-medium">Total Balance</p>
                                <h3 className="text-4xl font-bold text-white mt-1">{balance.toLocaleString()} <span className="text-lg opacity-80">QUBIC</span></h3>
                            </div>
                        </div>
                        <div className="z-10">
                            <p className="text-emerald-100/60 text-xs font-mono mb-2">WALLET ADDRESS</p>
                            <p className="text-white/80 font-mono text-sm bg-black/20 p-2 rounded w-fit">0x71C...9B2A</p>
                        </div>
                    </div>

                    <div className="glass-card rounded-2xl p-8 flex flex-col justify-center items-center text-center">
                        <h3 className="text-xl font-bold text-white">Unclaimed Mining Rewards</h3>
                        <p className="text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-cyan-400 my-4">
                            +{pendingRewards.toFixed(2)}
                        </p>
                        <button 
                            onClick={claimRewards}
                            disabled={pendingRewards === 0}
                            className="w-full py-3 bg-white text-black font-bold rounded-xl hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                        >
                            Claim to Wallet
                        </button>
                    </div>
                </div>
            </div>
        );

        // --- MAIN APP ---
        const App = () => {
            const [activeTab, setTab] = useState('dash');
            const [isMining, setIsMining] = useState(false);
            const [balance, setBalance] = useState(12500);
            const [pendingRewards, setPendingRewards] = useState(0);
            const [trainingData, setTrainingData] = useState([0.8]);

            useEffect(() => {
                let interval;
                if (isMining) {
                    interval = setInterval(() => {
                        setPendingRewards(prev => prev + 0.15);
                        setTrainingData(prev => {
                            const last = prev[prev.length - 1];
                            const noise = (Math.random() - 0.3) * 0.05;
                            const newVal = Math.max(0.05, last * 0.98 + noise);
                            const newData = [...prev, newVal];
                            if(newData.length > 50) newData.shift();
                            return newData;
                        });
                    }, 200);
                }
                return () => clearInterval(interval);
            }, [isMining]);

            const handleClaim = () => {
                setBalance(b => b + pendingRewards);
                setPendingRewards(0);
            };

            return (
                <div className="flex h-screen w-full text-gray-100">
                    <Sidebar activeTab={activeTab} setTab={setTab} />
                    <main className="flex-1 bg-[#030712] overflow-auto relative">
                        {activeTab === 'dash' && <DashboardView isMining={isMining} />}
                        {activeTab === 'mining' && <MiningView isMining={isMining} setIsMining={setIsMining} trainingData={trainingData} />}
                        {activeTab === 'wallet' && <WalletView balance={balance} claimRewards={handleClaim} pendingRewards={pendingRewards} />}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>